<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>方宝瑞的小餐馆</title>
        <meta name="description" content="Charcoal is a free Bootstrap 4 UI kit build by @attacomsian at Wired Dots." />
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <!--Bootstrap 4-->
        <link rel="stylesheet" href="css/bootstrap.min.css">
    </head>
    <body>
        <nav class="navbar navbar-expand-md navbar-dark fixed-top sticky-navigation bg-primary">
            <a class="navbar-brand font-weight-bold" href="#">Charcoal</a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#topMenu" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="topMenu">
                <ul class="navbar-nav ml-auto">
                    <li class="nav-item active">
                        <a class="nav-link page-scroll" href="#brand-colors">Home <span class="sr-only">(current)</span></a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="theme-components" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            Components
                        </a>
                        <div class="dropdown-menu dropdown-menu-right" aria-labelledby="theme-components">
                            <a class="dropdown-item page-scroll" href="#brand-colors">Brand colors</a>
                            <a class="dropdown-item page-scroll" href="#links">Links</a>
                            <a class="dropdown-item page-scroll" href="#grid">Grid</a>
                            <a class="dropdown-item page-scroll" href="#fonts">Fonts</a>
                            <a class="dropdown-item page-scroll" href="#buttons">Buttons</a>
                            <a class="dropdown-item page-scroll" href="#forms">Forms</a>
                            <a class="dropdown-item page-scroll" href="#dropdown">Dropdown</a>
                            <a class="dropdown-item page-scroll" href="#navs">Navs</a>
                            <a class="dropdown-item page-scroll" href="#navbar">Navbar</a>
                            <a class="dropdown-item page-scroll" href="#tables">Tables</a>
                            <a class="dropdown-item page-scroll" href="#pagination">Pagination</a>
                            <a class="dropdown-item page-scroll" href="#jumbotron">Jumbotron</a>
                            <a class="dropdown-item page-scroll" href="#cards">Cards</a>
                            <a class="dropdown-item page-scroll" href="#tooltip">Tooltip</a>
                            <a class="dropdown-item page-scroll" href="#popovers">Popovers</a>
                            <a class="dropdown-item page-scroll" href="#badges">Badges</a>
                            <a class="dropdown-item page-scroll" href="#modals">Modals</a>
                            <a class="dropdown-item page-scroll" href="#alerts">Alerts</a>
                            <a class="dropdown-item page-scroll" href="#progress-bars">Progress bars</a>
                            <a class="dropdown-item page-scroll" href="#list-group">List group</a>
                            <a class="dropdown-item page-scroll" href="#image-thumbnails">Image thumbnails</a>
                            <a class="dropdown-item page-scroll" href="#figures">Figures</a>
                            <a class="dropdown-item page-scroll" href="#breadcrumbs">Breadcrumbs</a>
                            <a class="dropdown-item page-scroll" href="#carousel">Carousel</a>
                            <a class="dropdown-item page-scroll" href="#close">Close icon</a>
                            <a class="dropdown-item page-scroll" href="#code">Code</a>
                        </div>
                    </li>
                </ul>
                <form class="form-inline ml-md-3">
                    <a href="#" class="btn btn-light">Download</a>
                </form>
            </div>
        </nav>

        <div id="myorder">
            <!--hero section-->
            <section class="bg-hero">
                <div class="container">
                    <div class="row vh-100">
                        <div class="col-sm-12 my-auto text-center">
                            <h1>Charcoal</h1>
                            <p class="lead text-capitalize my-4">
                                A free Bootstrap 4 UI Kit made for quick customizations
                            </p>
                            <a href="https://themewagon.com/themes/free-app-ui-kit-charcoal" class="btn btn-outline-light btn-radius btn-lg">Free Download</a>
                        </div>
                    </div>
                </div>
            </section>

            <!--components-->
            <section class="my-5 pt-5">
                <div class="container">
 
                    <div class="row mb-5" id="tables">
                        <div class="col-sm-12">
                           
                            <h1>方宝瑞的菜馆</h1>
                            <div class="mt-3 mb-5">
                                <div>
                                    <h3>菜单</h3>
                                    <!--<span style="text-align:left"><h3>菜单</h3></span>-->
                                    <span style="text-align:right">
                                        <button type="button" class="btn btn-primary" v-on:click="insert_show()">新增</button>
                                    </span>
                                </div>
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>名称</th>
                                            <th>单价</th>
                                            <th>操作</th>
                                        </tr>
                                    </thead>
                                    <tfoot>
                                        <tr v-show="show_flag == true">                                           
                                            <th>
                                                <input type="text" v-model="dish.name">
                                            </th>
                                            <th>
                                                <input type="text" v-model="dish.price">
                                            </th>
                                            <th style="text-align:left">
                                                <button type="button" class="btn btn-primary" v-on:click="insert_dish()">提交</button>
                                            </th>
                                        </tr>
                                    </tfoot>
                                    <tbody>
                                        <tr v-for="dish in dishes">
                                            <td>{{dish.name}}</td>
                                            <td>{{dish.price/100}}</td>
                                            <td>
                                                <button type="button" class="btn btn-primary" v-on:click="update_dish(dish.id)">修改</button>
                                                <button type="button" class="btn btn-primary" v-on:click="delete_dish(dish.id)">删除</button>
                                            </td>
                                        </tr>

                                    </tbody>
                                </table>
                            </div>

                        </div>
                    </div>

                    <!-- Pagination  -->
                    <div class="row mb-5" id="pagination">

                    </div>

                    <!-- Jumbotron  -->
                    <div class="row mb-5" id="jumbotron">

                    </div>

                </div>
            </section>

            <!--footer-->
            <section class="py-5 bg-dark">
                <div class="container">
                    <div class="row">
                        <div class="col-md-6 offset-md-3 col-sm-8 offset-sm-2 col-xs-12 text-center">

                            <p class="pt-2 text-muted">
                                &copy;Author@fangbaorui
                            </p>
                            <p class="small">
                                <a rel="nofollow" target="_blank" href="https://www.baidu.com">powered by baidu</a>
                            </p>
                        </div>
                    </div>
                </div>
            </section>
        </div>
        <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.3/umd/popper.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js"></script>
        <script src="js/app.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
        <script>
            var app = new Vue({
                el: '#myorder',
                data: {
                    dishes: [],
                    show_flag: false,
                    dish: {
                        name: "",
                        price:0
                    }
                },
                methods: {
                    get_total: function () {
                        var total = 0;
                        for (i = 0; i < this.dishes.length; i++) {
                            if (this.dishes[i].selected) {
                                total += (this.dishes[i].price / 100);
                            }
                        }
                        return total;
                    },
                    insert_order: function () {
                        //{id:,dish:[dish_id1,dish_id2],...}
                        var order = {
                            dishes: []
                        };
                        //
                        for (i = 0; i < this.dishes.length; i++) {
                            if (this.dishes[i].selected) {
                                order.dishes.push(this, dishes[i].id);
                            }
                        }
                        $.ajax({
                            url: "/order",
                            type: "post",
                            data: JSON.stringify(order),
                            success: function (res, status, xhr) {
                                if (xhr.status == 200) {
                                    alert("下单成功");
                                }
                            }
                        })
                    },
                    get_alldishes: function () {
                        $.ajax({
                            url: "/dish",
                            type: "get",
                            context:this,
                            success: function (res, status, xhr) {
                                this.dishes = JSON.parse(res);
                            }
                        })
                    },
                    insert_show: function(){
                        this.show_flag = true;
                    },
                    insert_dish: function () {
                        this.dish.price *= 100;
                        $.ajax({
                            url: "/dish",
                            type: "post",
                            data:JSON.stringify(this.dish),
                            context: this,
                            success: function (res, status, xhr) {
                                this.get_alldishes();
                                this.show_flag = false;
                            }
                        })
                    },
                    delete_dish: function (dish_id) {
                        $.ajax({
                            url: "/dish/" + dish_id,
                            type: "delete",
                            data: JSON.stringify(this.dish),
                            context: this,
                            success: function (res, status, xhr) {
                                alert("删除成功");
                                this.get_alldishes();
                                this.show_flag = false;
                            }
                        })
                    }
                }
            });
            app.get_alldishes();
        </script>
    </body>
</html>




